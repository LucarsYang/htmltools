# 新模組規格書：扣分管理 (Deduction Management)

**版本：** 1.0
**日期：** 2025年9月19日

## 1. 總覽 (Overview)

### 1.1. 模組目的
本模組旨在為現有的「學生管理頁 (`students.html`)」擴充一個全新的 **「扣分管理」** 功能。此功能允許教師預先建立標準化的扣分項目（如：未交作業 -5分），並能在學生卡片上快速套用，從而簡化分數管理流程並提升一致性。

### 1.2. 遵循規則
本規格書與其對應的程式碼開發，將嚴格遵循 `GEMINI.md` 中定義的程式撰寫規則：
- 所有功能將整合至 `students.html`，確保單一檔案即可運作。
- 本模組將擁有獨立的 CSS 與 JS 檔案。
- 所有新增的 UI/UX 元素，其視覺風格將與 `students.md` 及 `exam-countdown-timer.md` 中描述的現有燈箱、按鈕等風格保持一致。

---

## 2. 功能需求 (Functional Requirements)

本模組的所有互動介面，應統一使用 **燈箱 (Lightbox) 模式** 呈現，避免頁面跳轉，確保與「考試倒數計時器」等現有模組體驗一致。

### 2.1. 模組入口 (Entry Point)
- 在 `students.html` 的左側側邊欄「功能選單」區塊，應新增一個名為「**扣分項目管理**」的連結。
- 點擊此連結後，應觸發一個全螢幕的 container 燈箱，由 `deduction-management.js` 負責將本模組的操作介面注入其中。

### 2.2. 「扣分項目管理」燈箱介面
此為本模組的核心設定介面。

#### 2.2.1. 介面佈局
- **標題區**：顯示「管理扣分項目」標題與簡要說明文字。
- **內容區**：以 **表格 (Table)** 形式列出所有已建立的扣分項目。表格欄位應包含：「項目名稱」、「扣除分數」、「操作」。
- **操作區**：提供一個「**+ 新增扣分項目**」按鈕。
- **關閉按鈕**：在燈箱的右上角應有一個明確的 "X" 按鈕，用於關閉此管理介面。

#### 2.2.2. 核心功能
- **新增/編輯項目**：
    - 點擊「新增」按鈕，或點擊項目列表中任一筆資料的「編輯」按鈕，應觸發 **第二層燈箱**。
    - 此燈箱為一表單，包含「項目名稱」（文字輸入框）與「扣除分數」（數字輸入框，應進行驗證，確保為負數或零）。
    - 表單提供「儲存」與「取消」按鈕。
- **刪除項目**：
    - 點擊項目列表中的「刪除」按鈕。
    - 應觸發一個 **系統確認對話框** (例如 `window.confirm`)，提示使用者「確定要刪除此項目嗎？」。
    - 確認後，該項目從資料中移除並即時更新列表。

---

## 3. 與 `students.html` 主畫面的整合 (Integration)

本模組的功能最終將體現在 `students.html` 的學生卡片上。

### 3.1. 學生卡片 UI 調整
- 在既有的「自訂分數」區塊下方，新增一個區塊。
- 此區塊包含一個 **下拉式選單 (Select)** 與一個「**確定**」按鈕。

### 3.2. 資料聯動 (Data Binding)
- 該下拉式選單的選項 (`<option>`) 必須 **動態載入** 所有在「扣分項目管理」模組中建立的項目。
- 選項文字建議格式為「`{項目名稱} ({分數})`」，例如：「未交作業 (-5)」。

### 3.3. 功能邏輯
- 使用者從下拉選單選擇一個項目後，點擊「確定」。
- 系統應根據所選項目對應的分數，更新該學生的總分。
- 此操作應被視為一次分數變動，並記錄至該學生的歷史資料中（若未來有實作歷史紀錄功能）。

---

## 4. 資料結構 (Data Structure)

為儲存本模組的資料，建議擴充 `localStorage` 中 `classes` 物件的結構。

- 在 `classes` 物件的頂層，新增一個 `deductionItems` 陣列。
- 此陣列中的每個物件代表一個扣分項目。

**建議結構範例：**
```json
{
  "501": [ 
    {
      "name": "王小明",
      "score": 80
    }
  ],
  "scoreButtons": [-5, -1, 1, 5],
  "rewards": ["獎勵", "懲罰"],
  "deductionItems": [
    { "id": 1, "name": "未交作業", "points": -5 },
    { "id": 2, "name": "上課吵鬧", "points": -2 }
  ]
}