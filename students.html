<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <title>班級學員分數管理</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="css/students.css" />
    <link rel="stylesheet" href="css/exam-countdown-timer.css" />
    <link rel="stylesheet" href="css/wheel.css" />
</head>
<body>
<div class="app-shell">
    <aside class="sidebar" id="sidebar" aria-label="主功能選單">
        <button class="sidebar-toggle" type="button" onclick="toggleSidebar()" aria-label="切換側邊欄">☰</button>

        <section class="menu-group" aria-labelledby="account-group">
            <h2 class="menu-group-title" id="account-group">帳號管理</h2>
            <a class="menu-item" id="login-btn" style="display:none;">
                <i aria-hidden="true">👤</i><span>登入 Google</span>
            </a>
            <a class="menu-item" id="logout-btn" style="display:none;">
                <i aria-hidden="true">🚪</i><span>登出</span>
            </a>
        </section>

        <section class="menu-group" aria-labelledby="class-group">
            <h2 class="menu-group-title" id="class-group">班級</h2>
            <div class="menu-item">
                <i aria-hidden="true">📚</i>
                <span><select id="classSelect" style="display:none;"></select></span>
            </div>
        </section>

        <section class="menu-group" aria-labelledby="feature-group">
            <h2 class="menu-group-title" id="feature-group">功能選單</h2>
            <a class="menu-item" id="btnScoreSettings"><i aria-hidden="true">⚙️</i><span>分數按鈕設定</span></a>
            <a class="menu-item" id="btnClassManage"><i aria-hidden="true">📝</i><span>班級管理</span></a>
            <a class="menu-item" id="btnAddStudent"><i aria-hidden="true">➕</i><span>新增學生</span></a>
            <a class="menu-item" id="btnWheel"><i aria-hidden="true">🎡</i><span>輪轉盤</span></a>
            <a class="menu-item" id="btnExportCSV"><i aria-hidden="true">📤</i><span>匯出 CSV</span></a>
            <a class="menu-item" id="btnImportCSV"><i aria-hidden="true">📥</i><span>匯入 CSV</span></a>
            <a class="menu-item" id="btnExamTimer"><i aria-hidden="true">⏰</i><span>考試倒數計時器</span></a>
        </section>

        <section class="menu-group" aria-labelledby="sync-group">
            <h2 class="menu-group-title" id="sync-group">同步狀態</h2>
            <button class="sync-status" id="syncStatusBar" type="button" aria-live="polite">
                <span id="statusDirty" class="grey">有異動</span>
                <span id="statusUpdating" class="grey">更新中</span>
                <span id="statusSynced" class="grey">已同步</span>
            </button>
        </section>
    </aside>

    <main class="main-content" id="mainContent">
        <header class="page-header">
            <h1>班級學員分數管理</h1>
            <p class="page-hint">管理學員資訊、分數與教學工具，一頁完成</p>
        </header>
        <section class="student-list" aria-live="polite" aria-label="學生列表">
            <div class="container" id="studentContainer"></div>
        </section>
    </main>
</div>

<input type="file" id="importCSV" accept=".csv" hidden />

<div class="login-overlay" id="loginOverlay" role="presentation"></div>
<div class="login-popup" id="loginPopup" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h2 id="loginTitle">請選擇登入方式</h2>
    <p>若不登入，系統僅使用本地資料（離線模式）。</p>
    <div class="dialog-actions">
        <button id="btnLoginNow" class="btn-primary" type="button">登入 Google</button>
        <button id="btnOffline" class="btn-secondary" type="button">離線模式</button>
    </div>
    <p class="warn">注意：之後登入 Google 可能會覆蓋本地資料</p>
</div>

<div class="login-processing-overlay" id="loginProcessingOverlay" role="presentation"></div>
<div class="login-processing-popup" id="loginProcessingPopup" role="alertdialog" aria-modal="true">
    <h2>登入中，請稍候...</h2>
    <p>如關閉 Google 彈窗或登入失敗，將回到登入選擇。</p>
</div>

<div class="overlay" id="overlay" role="presentation"></div>
<div class="popup" id="studentPopup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
    <h2 id="popupTitle">新增學生</h2>
    <label class="field">
        <span>姓名</span>
        <input type="text" id="studentName" placeholder="輸入姓名" />
    </label>
    <label class="field">
        <span>分數</span>
        <input type="number" id="studentScore" placeholder="輸入分數" min="0" />
    </label>
    <label class="field">
        <span>性別</span>
        <select id="studentGender">
            <option value="男">男生</option>
            <option value="女">女生</option>
        </select>
    </label>
    <div class="image-preview" id="imageSelection" aria-label="預設頭像選擇"></div>
    <div class="custom-image-upload">
        <button id="btnUploadImage" class="btn-primary" type="button">上傳自訂圖片</button>
        <input type="file" id="customImageUpload" accept="image/*" hidden />
        <div id="customImagePreview" class="custom-image-preview" aria-live="polite"></div>
    </div>
    <div class="dialog-actions">
        <button id="btnSaveStudent" class="btn-primary" type="button">儲存</button>
        <button id="btnClosePopup" class="btn-secondary" type="button">取消</button>
    </div>
</div>

<div class="class-overlay" id="classOverlay" role="presentation"></div>
<div class="class-popup" id="classPopup" role="dialog" aria-modal="true" aria-labelledby="classPopupTitle">
    <h2 id="classPopupTitle">班級管理</h2>
    <button id="btnAddClass" class="btn-primary" type="button">新增班級</button>
    <div class="class-list" id="classList"></div>
    <div class="dialog-actions">
        <button id="btnCloseClassPopup" class="btn-secondary" type="button">關閉</button>
    </div>
</div>

<div class="sync-overlay" id="syncOverlay" role="presentation"></div>
<div class="sync-popup" id="syncPopup" role="alertdialog" aria-modal="true">
    <h2>資料同步中，請稍後...</h2>
</div>

<div id="wheel-main-container"></div>

<script type="module" src="js/students/app.js"></script>
<script src="js/exam-countdown-timer.js"></script>
</body>
</html>
